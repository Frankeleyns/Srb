# 01-数据字典介绍



## 一、 简介

何为数据字典？数据字典负责管理系统常用的分类数据或者一些固定数据，例如：省市区三级联动数据、民族数据、行业数据、学历数据等，数据字典帮助我们方便的获取和适用这些通用数据。



## 二、数据字典的设计

![数据字典](./img/02/DictSql.png)

- **parent_id**：上级id，通过id与parent_id构建上下级关系，例如：我们要获取所有行业数据，那么只需要查询parent_id=20000的数据
- **name**：名称，例如：填写用户信息，我们要select标签选择民族，“汉族”就是数据字典的名称
- **value**：值，例如：填写用户信息，我们要select标签选择民族，“1”（汉族的标识）就是数据字典的值
- **dict_code**：编码，编码是我们自定义的，全局唯一，例如：我们要获取行业数据，我们可以通过parent_id获取，但是parent_id是不确定的，所以我们可以根据编码来获取行业数据





# 02-Excel 数据批量导入



## 一、前端页面

### 1. 路由

在 **src/router/index.js** 中添加 数据字典的路由

```js
  {
    path: "/core/dict",
    component: Layout,
    redirect: '/core/dict/list',
    meta: { title: '系统设置', icon: 'el-icon-setting' },
    children: [
      {
        path: "list",
        name: "数据字典",
        component: () => import("@/views/core/dict/list"),
        meta: {title: "数据字典" }
      }
    ]
  },
```





### 2. 页面

创建 **src/views/core/dict/list.vue**

```html
<template>
  <div class="app-container">
    <div style="margin-bottom: 10px;">
      <el-button
        @click="dialogVisible = true"
        type="primary"
        size="mini"
        icon="el-icon-download"
      >
        导入Excel
      </el-button>
    </div>

    <el-dialog title="数据字典导入" :visible.sync="dialogVisible" width="30%">
      <el-form>
        <el-form-item label="请选择Excel文件">
          <el-upload
            :before-upload="beforeFileUpload"
            :auto-upload="true"
            :multiple="false"
            :limit="1"
            :on-exceed="fileUploadExceed"
            :on-success="fileUploadSuccess"
            :on-error="fileUploadError"
            :action="BASE_API + '/admin/core/dict/import'"
            name="file"
            accept="application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
          >
            <el-button size="small" type="primary">点击上传</el-button>
          </el-upload>
        </el-form-item>
      </el-form>                                                                                                                                                                                           
      <div slot="footer" class="dialog-footer">
        <el-button @click="dialogVisible = false">
          取消
        </el-button>
      </div>
    </el-dialog>
  </div>
</template>
```



### 3. Js

```js
export default {
    // 定义数据模型
    data() {
        return {
            dialogVisible: false, // 上传文件对话框是否开启
            BASE_API: process.env.VUE_APP_BASE_API //获取后端接口地址
        }
    },
    methods: {
        // 上传之前，判断文件类型，只能上传 Excel
        beforeFileUpload(file) {
            const fileType = file.type === "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" ||
                        file.type === "application/vnd.ms-excel";            
            if(!fileType) {
                this.$message.error("请上传 Excel 文件")
            }
            return fileType
        },

        // 文件上传超出
        fileUploadExceed() {
            this.$message.warning("只能上传一个文件")
        },

        // 文件上传成功
        fileUploadSuccess(res) {
            if(res.code == 0){
                this.$message.success("数据导入成功")
                this.dialogVisible = false
            } else {
                this.$meesage.error(res.message)
            }
            
        },

        // 文件上传失败
        fileUploadError(error) {
            this.$message.error("数据导入失败")
        }
    }
}
```

### 4. 运行结果

![前端页面](./img/02/FrontEnd.png)





## 二、后端接口

### 1. 添加依赖

在 **srb-core** 的 pom 中添加依赖

```xml
<dependency> 
    <groupId>com.alibaba</groupId>
    <artifactId>easyexcel</artifactId>
</dependency>

<dependency>
    <groupId>org.apache.xmlbeans</groupId>
    <artifactId>xmlbeans</artifactId>
</dependency>
```

